#! /bin/csh
#$ -V
#$ -S /bin/csh
#$ -o /cellar/users/ramarty/Data/kir/sge-system_files
#$ -e /cellar/users/ramarty/Data/kir/sge-system_files
#$ -cwd
#$ -t 1-154
#$ -l h_vmem=2G
#$ -tc 5
#$ -pe smp 8
#$ -l long
set barcodes=(TCGA-02-0033 TCGA-02-0047 TCGA-06-0185 TCGA-06-0221 TCGA-06-0876 TCGA-06-0877 TCGA-06-2566 TCGA-06-5410 TCGA-06-5411 TCGA-06-6699 TCGA-09-2051 TCGA-09-2056 TCGA-10-0926 TCGA-12-0775 TCGA-12-0822 TCGA-12-0827 TCGA-13-0805 TCGA-14-1456 TCGA-16-0849 TCGA-17-Z048 TCGA-21-1082 TCGA-22-1002 TCGA-22-4599 TCGA-23-1031 TCGA-24-1474 TCGA-24-1551 TCGA-25-2401 TCGA-26-1799 TCGA-27-2518 TCGA-28-2499 TCGA-28-2509 TCGA-2G-AAGJ TCGA-2K-A9WE TCGA-30-1853 TCGA-32-4719 TCGA-33-AASJ TCGA-34-5241 TCGA-37-4129 TCGA-3A-A9I5 TCGA-3A-A9J0 TCGA-44-6145 TCGA-44-A479 TCGA-49-4510 TCGA-49-4512 TCGA-4Z-AA84 TCGA-55-7907 TCGA-55-8620 TCGA-58-8388 TCGA-58-8393 TCGA-58-A46N TCGA-5R-AAAM TCGA-62-8394 TCGA-66-2794 TCGA-76-4925 TCGA-76-4931 TCGA-86-8278 TCGA-94-8490 TCGA-96-A4JL TCGA-97-A4M7 TCGA-A3-3367 TCGA-A4-7584 TCGA-A4-8517 TCGA-A8-A075 TCGA-AB-2844 TCGA-AB-2939 TCGA-B0-5106 TCGA-B0-5121 TCGA-B0-5697 TCGA-B2-A4SR TCGA-B7-A5TK TCGA-B8-5553 TCGA-BA-6873 TCGA-BF-A1PZ TCGA-BH-A0BO TCGA-BR-6709 TCGA-BR-7851 TCGA-BR-8285 TCGA-BR-A4J8 TCGA-BT-A20N TCGA-CC-A7IF TCGA-CF-A27C TCGA-CG-4469 TCGA-CJ-6030 TCGA-CM-4743 TCGA-CN-5358 TCGA-CN-6021 TCGA-CQ-5332 TCGA-CQ-A4CE TCGA-CR-6467 TCGA-CR-7404 TCGA-CS-6670 TCGA-CV-7103 TCGA-CV-7430 TCGA-CZ-5988 TCGA-D1-A0ZP TCGA-D1-A16E TCGA-D7-A4YX TCGA-DD-AAE2 TCGA-DH-5140 TCGA-DJ-A4UW TCGA-DO-A1K0 TCGA-DU-7306 TCGA-DU-A7T6 TCGA-E1-A7Z4 TCGA-EB-A3XB TCGA-ED-A7PY TCGA-EE-A2MQ TCGA-EE-A3J7 TCGA-EJ-5504 TCGA-EJ-7317 TCGA-EJ-A65M TCGA-EJ-A8FO TCGA-EM-A1CW TCGA-EM-A2P1 TCGA-ER-A19K TCGA-ET-A3DW TCGA-FA-A7DS TCGA-FR-A729 TCGA-FS-A4FC TCGA-FV-A495 TCGA-G9-6333 TCGA-G9-6385 TCGA-GR-7353 TCGA-H2-A3RI TCGA-HC-7078 TCGA-HE-A5NK TCGA-HT-7695 TCGA-HT-A5R7 TCGA-HT-A74J TCGA-IM-A3U3 TCGA-J4-A83L TCGA-KK-A6E5 TCGA-LA-A446 TCGA-NF-A4WX TCGA-OR-A5K6 TCGA-OR-A5LO TCGA-P5-A737 TCGA-QH-A65X TCGA-R5-A805 TCGA-S4-A8RM TCGA-S9-A6TY TCGA-S9-A7QY TCGA-SW-A7EB TCGA-UY-A78K TCGA-VM-A8CE TCGA-VQ-A91V TCGA-VQ-AA6G TCGA-WE-A8ZN TCGA-X4-A8KQ TCGA-XK-AAIV TCGA-XV-A9VZ TCGA-YG-AA3P TCGA-Z2-AA3V TCGA-ZN-A9VQ)
set outs=(/nrnb/users/ramarty/TCGA/exomes/TCGA-02-0033 /nrnb/users/ramarty/TCGA/exomes/TCGA-02-0047 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-0185 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-0221 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-0876 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-0877 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-2566 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-5410 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-5411 /nrnb/users/ramarty/TCGA/exomes/TCGA-06-6699 /nrnb/users/ramarty/TCGA/exomes/TCGA-09-2051 /nrnb/users/ramarty/TCGA/exomes/TCGA-09-2056 /nrnb/users/ramarty/TCGA/exomes/TCGA-10-0926 /nrnb/users/ramarty/TCGA/exomes/TCGA-12-0775 /nrnb/users/ramarty/TCGA/exomes/TCGA-12-0822 /nrnb/users/ramarty/TCGA/exomes/TCGA-12-0827 /nrnb/users/ramarty/TCGA/exomes/TCGA-13-0805 /nrnb/users/ramarty/TCGA/exomes/TCGA-14-1456 /nrnb/users/ramarty/TCGA/exomes/TCGA-16-0849 /nrnb/users/ramarty/TCGA/exomes/TCGA-17-Z048 /nrnb/users/ramarty/TCGA/exomes/TCGA-21-1082 /nrnb/users/ramarty/TCGA/exomes/TCGA-22-1002 /nrnb/users/ramarty/TCGA/exomes/TCGA-22-4599 /nrnb/users/ramarty/TCGA/exomes/TCGA-23-1031 /nrnb/users/ramarty/TCGA/exomes/TCGA-24-1474 /nrnb/users/ramarty/TCGA/exomes/TCGA-24-1551 /nrnb/users/ramarty/TCGA/exomes/TCGA-25-2401 /nrnb/users/ramarty/TCGA/exomes/TCGA-26-1799 /nrnb/users/ramarty/TCGA/exomes/TCGA-27-2518 /nrnb/users/ramarty/TCGA/exomes/TCGA-28-2499 /nrnb/users/ramarty/TCGA/exomes/TCGA-28-2509 /nrnb/users/ramarty/TCGA/exomes/TCGA-2G-AAGJ /nrnb/users/ramarty/TCGA/exomes/TCGA-2K-A9WE /nrnb/users/ramarty/TCGA/exomes/TCGA-30-1853 /nrnb/users/ramarty/TCGA/exomes/TCGA-32-4719 /nrnb/users/ramarty/TCGA/exomes/TCGA-33-AASJ /nrnb/users/ramarty/TCGA/exomes/TCGA-34-5241 /nrnb/users/ramarty/TCGA/exomes/TCGA-37-4129 /nrnb/users/ramarty/TCGA/exomes/TCGA-3A-A9I5 /nrnb/users/ramarty/TCGA/exomes/TCGA-3A-A9J0 /nrnb/users/ramarty/TCGA/exomes/TCGA-44-6145 /nrnb/users/ramarty/TCGA/exomes/TCGA-44-A479 /nrnb/users/ramarty/TCGA/exomes/TCGA-49-4510 /nrnb/users/ramarty/TCGA/exomes/TCGA-49-4512 /nrnb/users/ramarty/TCGA/exomes/TCGA-4Z-AA84 /nrnb/users/ramarty/TCGA/exomes/TCGA-55-7907 /nrnb/users/ramarty/TCGA/exomes/TCGA-55-8620 /nrnb/users/ramarty/TCGA/exomes/TCGA-58-8388 /nrnb/users/ramarty/TCGA/exomes/TCGA-58-8393 /nrnb/users/ramarty/TCGA/exomes/TCGA-58-A46N /nrnb/users/ramarty/TCGA/exomes/TCGA-5R-AAAM /nrnb/users/ramarty/TCGA/exomes/TCGA-62-8394 /nrnb/users/ramarty/TCGA/exomes/TCGA-66-2794 /nrnb/users/ramarty/TCGA/exomes/TCGA-76-4925 /nrnb/users/ramarty/TCGA/exomes/TCGA-76-4931 /nrnb/users/ramarty/TCGA/exomes/TCGA-86-8278 /nrnb/users/ramarty/TCGA/exomes/TCGA-94-8490 /nrnb/users/ramarty/TCGA/exomes/TCGA-96-A4JL /nrnb/users/ramarty/TCGA/exomes/TCGA-97-A4M7 /nrnb/users/ramarty/TCGA/exomes/TCGA-A3-3367 /nrnb/users/ramarty/TCGA/exomes/TCGA-A4-7584 /nrnb/users/ramarty/TCGA/exomes/TCGA-A4-8517 /nrnb/users/ramarty/TCGA/exomes/TCGA-A8-A075 /nrnb/users/ramarty/TCGA/exomes/TCGA-AB-2844 /nrnb/users/ramarty/TCGA/exomes/TCGA-AB-2939 /nrnb/users/ramarty/TCGA/exomes/TCGA-B0-5106 /nrnb/users/ramarty/TCGA/exomes/TCGA-B0-5121 /nrnb/users/ramarty/TCGA/exomes/TCGA-B0-5697 /nrnb/users/ramarty/TCGA/exomes/TCGA-B2-A4SR /nrnb/users/ramarty/TCGA/exomes/TCGA-B7-A5TK /nrnb/users/ramarty/TCGA/exomes/TCGA-B8-5553 /nrnb/users/ramarty/TCGA/exomes/TCGA-BA-6873 /nrnb/users/ramarty/TCGA/exomes/TCGA-BF-A1PZ /nrnb/users/ramarty/TCGA/exomes/TCGA-BH-A0BO /nrnb/users/ramarty/TCGA/exomes/TCGA-BR-6709 /nrnb/users/ramarty/TCGA/exomes/TCGA-BR-7851 /nrnb/users/ramarty/TCGA/exomes/TCGA-BR-8285 /nrnb/users/ramarty/TCGA/exomes/TCGA-BR-A4J8 /nrnb/users/ramarty/TCGA/exomes/TCGA-BT-A20N /nrnb/users/ramarty/TCGA/exomes/TCGA-CC-A7IF /nrnb/users/ramarty/TCGA/exomes/TCGA-CF-A27C /nrnb/users/ramarty/TCGA/exomes/TCGA-CG-4469 /nrnb/users/ramarty/TCGA/exomes/TCGA-CJ-6030 /nrnb/users/ramarty/TCGA/exomes/TCGA-CM-4743 /nrnb/users/ramarty/TCGA/exomes/TCGA-CN-5358 /nrnb/users/ramarty/TCGA/exomes/TCGA-CN-6021 /nrnb/users/ramarty/TCGA/exomes/TCGA-CQ-5332 /nrnb/users/ramarty/TCGA/exomes/TCGA-CQ-A4CE /nrnb/users/ramarty/TCGA/exomes/TCGA-CR-6467 /nrnb/users/ramarty/TCGA/exomes/TCGA-CR-7404 /nrnb/users/ramarty/TCGA/exomes/TCGA-CS-6670 /nrnb/users/ramarty/TCGA/exomes/TCGA-CV-7103 /nrnb/users/ramarty/TCGA/exomes/TCGA-CV-7430 /nrnb/users/ramarty/TCGA/exomes/TCGA-CZ-5988 /nrnb/users/ramarty/TCGA/exomes/TCGA-D1-A0ZP /nrnb/users/ramarty/TCGA/exomes/TCGA-D1-A16E /nrnb/users/ramarty/TCGA/exomes/TCGA-D7-A4YX /nrnb/users/ramarty/TCGA/exomes/TCGA-DD-AAE2 /nrnb/users/ramarty/TCGA/exomes/TCGA-DH-5140 /nrnb/users/ramarty/TCGA/exomes/TCGA-DJ-A4UW /nrnb/users/ramarty/TCGA/exomes/TCGA-DO-A1K0 /nrnb/users/ramarty/TCGA/exomes/TCGA-DU-7306 /nrnb/users/ramarty/TCGA/exomes/TCGA-DU-A7T6 /nrnb/users/ramarty/TCGA/exomes/TCGA-E1-A7Z4 /nrnb/users/ramarty/TCGA/exomes/TCGA-EB-A3XB /nrnb/users/ramarty/TCGA/exomes/TCGA-ED-A7PY /nrnb/users/ramarty/TCGA/exomes/TCGA-EE-A2MQ /nrnb/users/ramarty/TCGA/exomes/TCGA-EE-A3J7 /nrnb/users/ramarty/TCGA/exomes/TCGA-EJ-5504 /nrnb/users/ramarty/TCGA/exomes/TCGA-EJ-7317 /nrnb/users/ramarty/TCGA/exomes/TCGA-EJ-A65M /nrnb/users/ramarty/TCGA/exomes/TCGA-EJ-A8FO /nrnb/users/ramarty/TCGA/exomes/TCGA-EM-A1CW /nrnb/users/ramarty/TCGA/exomes/TCGA-EM-A2P1 /nrnb/users/ramarty/TCGA/exomes/TCGA-ER-A19K /nrnb/users/ramarty/TCGA/exomes/TCGA-ET-A3DW /nrnb/users/ramarty/TCGA/exomes/TCGA-FA-A7DS /nrnb/users/ramarty/TCGA/exomes/TCGA-FR-A729 /nrnb/users/ramarty/TCGA/exomes/TCGA-FS-A4FC /nrnb/users/ramarty/TCGA/exomes/TCGA-FV-A495 /nrnb/users/ramarty/TCGA/exomes/TCGA-G9-6333 /nrnb/users/ramarty/TCGA/exomes/TCGA-G9-6385 /nrnb/users/ramarty/TCGA/exomes/TCGA-GR-7353 /nrnb/users/ramarty/TCGA/exomes/TCGA-H2-A3RI /nrnb/users/ramarty/TCGA/exomes/TCGA-HC-7078 /nrnb/users/ramarty/TCGA/exomes/TCGA-HE-A5NK /nrnb/users/ramarty/TCGA/exomes/TCGA-HT-7695 /nrnb/users/ramarty/TCGA/exomes/TCGA-HT-A5R7 /nrnb/users/ramarty/TCGA/exomes/TCGA-HT-A74J /nrnb/users/ramarty/TCGA/exomes/TCGA-IM-A3U3 /nrnb/users/ramarty/TCGA/exomes/TCGA-J4-A83L /nrnb/users/ramarty/TCGA/exomes/TCGA-KK-A6E5 /nrnb/users/ramarty/TCGA/exomes/TCGA-LA-A446 /nrnb/users/ramarty/TCGA/exomes/TCGA-NF-A4WX /nrnb/users/ramarty/TCGA/exomes/TCGA-OR-A5K6 /nrnb/users/ramarty/TCGA/exomes/TCGA-OR-A5LO /nrnb/users/ramarty/TCGA/exomes/TCGA-P5-A737 /nrnb/users/ramarty/TCGA/exomes/TCGA-QH-A65X /nrnb/users/ramarty/TCGA/exomes/TCGA-R5-A805 /nrnb/users/ramarty/TCGA/exomes/TCGA-S4-A8RM /nrnb/users/ramarty/TCGA/exomes/TCGA-S9-A6TY /nrnb/users/ramarty/TCGA/exomes/TCGA-S9-A7QY /nrnb/users/ramarty/TCGA/exomes/TCGA-SW-A7EB /nrnb/users/ramarty/TCGA/exomes/TCGA-UY-A78K /nrnb/users/ramarty/TCGA/exomes/TCGA-VM-A8CE /nrnb/users/ramarty/TCGA/exomes/TCGA-VQ-A91V /nrnb/users/ramarty/TCGA/exomes/TCGA-VQ-AA6G /nrnb/users/ramarty/TCGA/exomes/TCGA-WE-A8ZN /nrnb/users/ramarty/TCGA/exomes/TCGA-X4-A8KQ /nrnb/users/ramarty/TCGA/exomes/TCGA-XK-AAIV /nrnb/users/ramarty/TCGA/exomes/TCGA-XV-A9VZ /nrnb/users/ramarty/TCGA/exomes/TCGA-YG-AA3P /nrnb/users/ramarty/TCGA/exomes/TCGA-Z2-AA3V /nrnb/users/ramarty/TCGA/exomes/TCGA-ZN-A9VQ)

set barcode=$barcodes[$SGE_TASK_ID]
set out=$outs[$SGE_TASK_ID]

date
hostname
echo $barcode

mkdir $out/features

python /cellar/users/ramarty/Projects/kir/KIR_development/data_gathering/bin/convert_to_fastq2.py $out/chr19.bam $out/KIR_sorted $out/KIR_dedup $out/KIR_and_unmapped.fastq cellar
echo Fastq stripped.

python /cellar/users/ramarty/Projects/kir/KIR_development/data_gathering/bin/map_to_reference.py $out/KIR_and_unmapped.fastq $out/KIR_and_unmapped.aligned.test.bam /cellar/users/ramarty/Data/kir/ref/all_alleles_and_random cellar
echo Mapped to KIR.

python /cellar/users/ramarty/Projects/kir/KIR_development/data_gathering/bin/convert_to_fastq2.py $out/KIR_and_unmapped.aligned.test.bam $out/KIR_sorted $out/KIR_dedup $out/KIR_and_unmapped.aligned.fastq cellar
echo Stripped reads.

python /cellar/users/ramarty/Projects/kir/KIR_development/data_gathering/bin/component_collection.py $out/KIR_and_unmapped.aligned.fastq $out/features /cellar/users/ramarty/Data/kir/kmers/kmer_groups/kir_four_random.txt kir_four_random
echo Components gathered - KIR.

rm $out/KIR_sorted
rm $out/KIR_dedup
rm $out/*fastq
date
